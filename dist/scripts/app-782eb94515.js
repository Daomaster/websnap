!function(){"use strict";angular.module("websnap",["ngRoute","ngMaterial","toastr","ngFileUpload"])}(),function(){"use strict";function e(){function e(e,t,n,o){var a=this;a.messageModal=function(n){e.show({controller:["$mdDialog","$scope","$q","ApiService","ImageService",function(e,t,n,a,r){var i,s,c,l=function(e){return s=s||e,s?t.allContacts.filter(m(s)):[]},m=function(e){var t=angular.lowercase(e);return function(e){return-1!=e._lowername.indexOf(t)}},d=function(e){return s=e,i&&g()?i:(p(),i=n(function(n,r){p=r,a.getquery(e,function(e){o.importContacts(e.data),t.allContacts=o.getContacts(),n(l()),u()})}))},u=function(){c=0,i=null,p=angular.noop},g=function(){var e=(new Date).getMilliseconds();return c=c||e,300>e-c},p=angular.noop;t.allContacts=o.getContacts(),t.tos=[],t.querySearch=d,t.$watch("imgFile",function(e){e&&r.processImage(e,document.getElementById("display-canvas"))}),t.cancel=function(){r.resetData(),e.cancel()},t.send=function(){t.msg.length<=140&&(a.sendmsg(t.tos,t.msg,r.getDataURL()),e.hide())}}],templateUrl:"app/components/listmenu/messageModal.html",parent:angular.element(t.body),targetEvent:n,clickOutsideToClose:!1,fullscreen:!0})},a.hover=function(){a.isOpen=!0},a.notHover=function(){a.isOpen=!1},a.isOpen=!1,a.mode="md-scale"}e.$inject=["$mdDialog","$document","Upload","ContactService"];var t={restrict:"E",templateUrl:"app/components/listmenu/listmenu.html",scope:{creationDate:"="},controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("websnap").directive("listmenu",e)}(),function(){"use strict";function e(){function e(e,t){var n=this;n.name=t.getUserName(),n.logout=function(){t.resetUserInfo(),e.path("login")}}e.$inject=["$location","ContactService"];var t={restrict:"E",templateUrl:"app/components/navbar/navbar.html",scope:{creationDate:"="},controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("websnap").directive("acmeNavbar",e)}(),function(){"use strict";function e(){function e(e,t,n){var o=this;o.options=n.getChats(),o.expand=function(n){e.show({controller:["$mdDialog","$scope","$interval","ChatService",function(e,t,o,a){t.from=n,t.index=0,t.chats=a.getChatsByName(n).content,t.progress=0;var r=1;t.cancel=function(){for(var s=t.chats.length-1;s>=0;s--)t.chats[s].progress=0;angular.isDefined(i)&&(o.cancel(i),i=void 0),a.deleteChatByIndex(n,r),t.index=0,r++,e.cancel()},t.next=function(){t.chats[t.index].progress=100,t.index++,t.index==t.chats.length?t.cancel():r++};var i=o(function(){t.chats[t.index].progress+=.67,t.chats[t.index].progress>=100&&t.next()},100,150*t.chats.length,!0)}],templateUrl:"app/components/chatbox/viewModal.html",parent:angular.element(t.body),clickOutsideToClose:!1,fullscreen:!0})}}e.$inject=["$mdDialog","$document","ChatService"];var t={restrict:"E",templateUrl:"app/components/chatbox/chatbox.html",scope:{creationDate:"="},controller:e,controllerAs:"vm",bindToController:!0};return t}angular.module("websnap").directive("chatbox",e)}(),angular.module("websnap").factory("SocketFactory",["$rootScope",function(e){var t="http://localhost:3005",n=io.connect(t);return{id:0,on:function(t,o){n.on(t,function(){var t=arguments;e.$apply(function(){o.apply(n,t)})})},emit:function(t,o,a){n.emit(t,o,function(){var t=arguments;e.$apply(function(){a&&a.apply(n,t)})})}}}]),function(){"use strict";angular.module("websnap").service("ImageService",function(){this.processImage=function(n,a){e=a,t=e.getContext("2d");var r=new FileReader;r.readAsDataURL(n),r.onload=function(){o.src=r.result,e.height=450,e.width=570}},this.getDataURL=function(){var e=a;return a="",e},this.resetData=function(){a="",e=null,t=null};var e,t,n=function(){t.drawImage(o,0,0,e.width,e.height),a=e.toDataURL()},o=document.createElement("img");o.crossOrigin="Anonymous",o.onload=n;var a=""})}(),function(){"use strict";angular.module("websnap").service("ContactService",["$q",function(e){var t="",n="",o="",a="",r=!1,i=[];this.authenticate=function(){return r?!0:e.reject("Not Authenticated")},this.resetUserInfo=function(){t="",n="",o="",a="",r=!1},this.registerUserInfo=function(e){t=e.username,n=e.fname,o=e.lname,a=e.objectId,r=!0},this.importContacts=function(e){i=e},this.getUserName=function(){return t},this.getFirstName=function(){return n},this.getLastName=function(){return o},this.getUserId=function(){return a},this.getContacts=function(){return i.map(function(e){var t={name:e.username,userId:e.objectId,_lowername:e.username.toLowerCase()};return t})}}])}(),function(){"use strict";angular.module("websnap").service("ChatService",["ApiService",function(e){var t=[];this.addChat=function(e,n,o,a){for(var r=!1,i=!1,s="http://localhost/api/resource/"+a,c=t.length-1;c>=0;c--)if(t[c].from==e){r=!0;for(var l=t[c].content-1;l>=0;l--)t[c].content[l].chatId==a&&(i=!0);i||t[c].content.unshift({msg:n,chatId:a,time:o,url:s,progress:0})}r||t.push({from:e,content:[{msg:n,chatId:a,time:o,url:s,progress:0}]})},this.deleteChatByIndex=function(n,o){for(var a=t.length-1;a>=0;a--)if(t[a].from==n){for(var r=o-1;r>=0;r--)e.removeChat(t[a].content[r].chatId);t[a].content.splice(0,o),0==t[a].content.length&&t.splice(a,1)}},this.getChatsByName=function(e){for(var n=t.length-1;n>=0;n--)if(t[n].from==e)return t[n]},this.getChats=function(){return t}}])}(),function(){"use strict";angular.module("websnap").service("ApiService",["$http","$log","ContactService",function(e,t,n){var o="http://localhost/api/",a=function(e){return o+e},r=function(e){t.info("API call success: "+e)},i=function(e){t.info("API call error: "+e+"\nAPI unavailable\nPlease check the network connection")};this.signup=function(t,n,o){var s=a("signup");return e.post(s,t).then(function(e){var t="Sign Up Sucsess!";r(t),n(e)},function(e){var t="Unable to Sign Up...";i(t),o(e)})},this.login=function(t,n,o){var s=a("login");return e.post(s,t).then(function(e){var t="Log in Sucsess!";r(t),n(e)},function(e){var t="Unable to Log in...";i(t),o(e)})},this.getquery=function(t,n){var o=a("getquery");return e.post(o,{query:t}).then(function(e){n(e)},function(){var e="Unable to retrive query data...";i(e)})},this.sendmsg=function(t,o,s){var c=a("sendmsg");return e.post(c,{from:n.getUserName(),tos:t,msg:o,url:s}).then(function(){var e="Message sent!";r(e)},function(e){console.log(e);var t="Unable to send message...";i(t)})},this.getUnreadMessage=function(t){var o=a("querydata");return e.post(o,{query:n.getUserId()}).then(function(e){var n="Got all the unread messages";r(n),t(e)},function(e){var t="Unable to retrive unread message...";i(t)})},this.removeChat=function(t){var n=a("removechat");return e.post(n,{objectId:t}).then(function(){var e="Deleted message "+t;r(e)},function(){var e="Unable to retrive unread message...";i(e)})}}])}(),function(){"use strict";function e(e,t,n,o){var a=function(e){if(e.data.length>0)for(var t=e.data.length-1;t>=0;t--)n.addChat(e.data[t].from,e.data[t].msg,e.data[t].time,e.data[t].objectId)};""!=t.getUserId()&&(o.getUnreadMessage(a),console.log("Listening WebSocket"),e.on(t.getUserId(),function(e){n.addChat(e.from,e.msg,e.time,e.chatId)}))}e.$inject=["SocketFactory","ContactService","ChatService","ApiService"],angular.module("websnap").controller("MainController",e)}(),function(){"use strict";function e(e,t,n,o){var a=this;a.toggle=!1,a.error=!1,a.errMsg="";var r=function(t){o.registerUserInfo(t.data),e.path("inbox")},i=function(e){a.errMsg=e.data.message||"Server is down at the moment...",a.error=!0};a.resetError=function(){a.error=!1,a.errMsg=""},a.login=function(){if(t.loginForm.$valid){var e={username:a.username,password:a.password};n.login(e,r,i)}else console.log("Not valid")},a.signup=function(){if(t.signupForm.$valid){var e={username:a.rUsername,password:a.rPassword,fname:a.fname,lname:a.lname};n.signup(e,r,i)}else console.log("Not valid")},a.toggleSignUp=function(){a.toggle=!a.toggle}}e.$inject=["$location","$scope","ApiService","ContactService"],angular.module("websnap").controller("LoginController",e)}(),function(){"use strict";function e(e,t,n){t.$on("$routeChangeError",function(e,t,o,a){"Not Authenticated"===a&&n.path("/login")})}e.$inject=["$log","$rootScope","$location"],angular.module("websnap").run(e)}(),function(){"use strict";function e(e,t){e.when("/inbox",{templateUrl:"app/main/main.html",controller:"MainController",controllerAs:"vm",resolve:{auth:["ContactService",function(e){return e.authenticate()}]}}).when("/login",{templateUrl:"app/login/login.html",controller:"LoginController",controllerAs:"vm"}).otherwise({redirectTo:"/login"}),t.html5Mode({enabled:!0,requireBase:!1})}e.$inject=["$routeProvider","$locationProvider"],angular.module("websnap").config(e)}(),function(){"use strict";function e(e,t){e.debugEnabled(!0),t.allowHtml=!0,t.timeOut=3e3,t.positionClass="toast-top-right",t.preventDuplicates=!0,t.progressBar=!0}e.$inject=["$logProvider","toastrConfig"],angular.module("websnap").config(e)}(),angular.module("websnap").run(["$templateCache",function(e){e.put("app/login/login.html",'<md-content style="background-color: #5C6BC0; height:100%"><div layout=row style=margin-top:10% layout-align="center center"><div flex=30><md-card><md-card-title><md-card-title-text><span style=color:#3F51B5 class=md-headline>Log In</span></md-card-title-text></md-card-title><md-card-content><form ng-show=vm.toggle name=signupForm><md-input-container class=md-block><label>First Name</label><input ng-model=vm.fname type=text ng-required=true ng-focus=vm.resetError()></md-input-container><md-input-container class=md-block><label>Last Name</label><input ng-model=vm.lname type=text ng-required=true ng-focus=vm.resetError()></md-input-container><md-input-container class=md-block><label>Username</label><input ng-model=vm.rUsername type=text ng-required=true ng-focus=vm.resetError()></md-input-container><md-input-container class=md-block><label>Password</label><input ng-model=vm.rPassword type=password ng-required=true ng-focus=vm.resetError()></md-input-container></form><form ng-show=!vm.toggle name=loginForm><md-input-container class=md-block><label>Username</label><md-icon md-svg-src=assets/images/mail.svg></md-icon><input ng-model=vm.username type=text ng-required=true ng-focus=vm.resetError()></md-input-container><md-input-container class=md-block><label>Password</label><md-icon md-svg-src=assets/images/password.svg></md-icon><input ng-model=vm.password type=password ng-required=true ng-focus=vm.resetError()></md-input-container></form><p style="color: #F44336" ng-show=vm.error>{{vm.errMsg}}</p></md-card-content><md-button ng-show=!vm.toggle ng-click=vm.login() class="md-raised md-primary">Log In</md-button><md-button ng-show=vm.toggle ng-click=vm.signup() class="md-raised md-primary">Sign Up</md-button><md-card-actions layout=row layout-align="end center"><md-button ng-show=!vm.toggle ng-click=vm.toggleSignUp() class=md-primary>Sign Up</md-button></md-card-actions></md-card></div></div></md-content>'),e.put("app/main/main.html",'<md-content style="height:100%; position:relative"><acme-navbar class=navbar></acme-navbar><div layout=row class=chat-container><div flex=10></div><div flex=80><chatbox></chatbox></div><div flex=10></div></div><listmenu></listmenu></md-content>'),e.put("app/components/chatbox/chatbox.html",'<md-card ng-repeat="item in vm.options" md-whiteframe=6 ng-click=vm.expand(item.from)><md-card-title><md-card-title-text><span>{{item.content.length}} Message from {{item.from}}</span></md-card-title-text></md-card-title><md-card-content layout=row layout-align="space-around center"><div flex=50><span>{{item.content[0].msg}}</span></div><div><span>{{item.content[0].time}}</span></div></md-card-content></md-card>'),e.put("app/components/chatbox/viewModal.html",'<md-dialog aria-label="Send Message"><form><md-toolbar><div class=md-toolbar-tools><h2>{{from}}</h2><span flex=""></span><md-button ng-click=cancel() class=md-icon-button><md-icon md-svg-src=assets/images/close.svg aria-label="Close dialog"></md-icon></md-button></div></md-toolbar><md-dialog-content class=message-modal><div layout=row><div flex=3></div><div flex=94><div layout=column><div flex=80><md-whiteframe layout layout-align="center center" class="md-whiteframe-3dp display-container"><image ng-src={{chats[index].url}} class=image-display></image></md-whiteframe></div></div></div><div flex=3></div></div><div class=message-view><p>{{chats[index].msg}}</p></div></md-dialog-content></form><div layout=row><md-progress-linear md-mode=determinate style=margin-right:5px value={{chat.progress}} ng-repeat="chat in chats"></md-progress-linear></div><md-dialog-actions layout=row><md-button ng-click=cancel()>Cancel</md-button><md-button ng-click=next() style=margin-right:20px>Next</md-button></md-dialog-actions></md-dialog>'),e.put("app/components/listmenu/listmenu.html",'<md-fab-speed-dial md-open=vm.isOpen ng-mouseenter=vm.hover() ng-mouseleave=vm.notHover() md-direction=up md-hover-full md-fab-bottom-right=md-fab-bottom-right ng-class=vm.mode><md-fab-trigger><md-button aria-label=Compose ng-click=vm.messageModal() class="md-fab md-warn"><md-tooltip md-direction=left>Compose</md-tooltip><md-icon md-svg-src=assets/images/compose.svg></md-icon></md-button></md-fab-trigger></md-fab-speed-dial>'),e.put("app/components/listmenu/messageModal.html",'<md-dialog aria-label="Send Message"><form><md-toolbar><div class=md-toolbar-tools><h2>Send Message</h2><span flex=""></span><md-button ng-click=cancel() class=md-icon-button><md-icon md-svg-src=assets/images/close.svg aria-label="Close dialog"></md-icon></md-button></div></md-toolbar><md-dialog-content class=message-modal><md-contact-chips ng-model=tos md-contacts=querySearch($query) md-contact-name=name md-require-match=true md-highlight-flags=i filter-selected=true placeholder=To></md-contact-chips><div layout=row><div flex=3></div><div flex=94><md-whiteframe layout layout-align="center center" class="md-whiteframe-3dp display-container"><div ng-show=!imgFile ngf-drop ngf-select ng-model=imgFile ngf-allow-dir=true ngf-drag-over-class="\'dragover\'" accept="image/svh+xml, image/png, image/jpeg, image/bmp" class=image-display>Drop or click to upload image</div><canvas ng-show=imgFile id=display-canvas class=image-display></canvas></md-whiteframe></div><div flex=3></div></div><md-input-container class=md-block><label>Message</label><textarea ng-model=msg md-maxlength=140 rows=4 md-select-on-focus=true></textarea></md-input-container></md-dialog-content></form><md-dialog-actions layout=row><md-button ng-click=cancel()>Cancel</md-button><md-button ng-click=send() style=margin-right:20px>Send</md-button></md-dialog-actions></md-dialog>'),e.put("app/components/navbar/navbar.html",'<md-toolbar layout=row layout-align="center center"><div class=md-toolbar-tools><h2>Web Snap</h2><span flex=""></span><span>Hello! {{vm.name}}</span><md-button aria-label=logout ng-click=vm.logout() class="md-raised md-warn md-mini">Log Out</md-button></div></md-toolbar>')}]);
//# sourceMappingURL=../maps/scripts/app-782eb94515.js.map
